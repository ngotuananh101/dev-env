# =====================================================
# LOCAL DEVELOPMENT OPTIMIZATION
# =====================================================

# ---------------------
# CONNECTIONS
# ---------------------
listen_addresses = 'localhost'
max_connections = 100

# ---------------------
# MEMORY (TỐI ƯU LOCAL)
# ---------------------
shared_buffers = 2GB
effective_cache_size = 6GB

work_mem = 32MB
hash_mem_multiplier = 2.0

maintenance_work_mem = 512MB
autovacuum_work_mem = 256MB

temp_buffers = 64MB

# ---------------------
# PARALLELISM
# ---------------------
max_worker_processes = 8
max_parallel_workers = 8
max_parallel_workers_per_gather = 4
max_parallel_maintenance_workers = 4
parallel_leader_participation = on

# ---------------------
# QUERY PLANNER (SSD / LOCAL)
# ---------------------
random_page_cost = 1.1
seq_page_cost = 1.0
effective_io_concurrency = 200
maintenance_io_concurrency = 200

# ---------------------
# WAL & DURABILITY (GIẢM ĐỘ BỀN → NHANH)
# ⚠️ KHÔNG DÙNG PRODUCTION
# ---------------------
fsync = off
synchronous_commit = off
full_page_writes = off

wal_compression = on
wal_buffers = 64MB

checkpoint_timeout = 15min
checkpoint_completion_target = 0.9
max_wal_size = 4GB
min_wal_size = 1GB

# ---------------------
# AUTOVACUUM (NHANH & CHỦ ĐỘNG)
# ---------------------
autovacuum = on
autovacuum_max_workers = 5
autovacuum_naptime = 30s

autovacuum_vacuum_scale_factor = 0.05
autovacuum_analyze_scale_factor = 0.02

autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50

# ---------------------
# LOGGING (DEV FRIENDLY)
# ---------------------
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d.log'

log_min_duration_statement = 300
log_statement = 'ddl'

log_autovacuum_min_duration = 0
log_checkpoints = on

# ---------------------
# JIT (TẮT → DỄ DEBUG)
# ---------------------
jit = off

# ---------------------
# TIMEZONE / LOCALE
# ---------------------
timezone = 'Asia/Ho_Chi_Minh'
log_timezone = 'Asia/Ho_Chi_Minh'
